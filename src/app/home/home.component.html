<app-header></app-header>

<main class="main-section mt-5">
  <form class="filter-section" [formGroup]="myForm" (ngSubmit)="onSubmit()">
    <div class="filter">

      <!--  region filter    -->

      <button type="button" class="filter-button"
              [ngClass]="{'filter-act-btn': regionFilter, 'filter-btn': !regionFilter}"
              (click)="regionFilterOn()">
        რეგიონი
        <img [src]="regionFilter ? '/assets/down-arrow.svg' : '/assets/up-arrow.svg'"
             [alt]="regionFilter ? 'active-filter' : 'inactive-filter'">

      </button>
      <!-- Template definition for the section -->
      <ng-template #regionSection>
        <section class="filter-details mt-2" [formGroup]="myForm" (ngSubmit)="onRegionSubmit()">
          <h5 class="text-start">რეგიონის მიხედვით</h5>

          <ul class="grid-list">
            <li *ngFor="let region of regions">
              <input
                type="checkbox"
                [id]="region.id"
                [value]="region.id"
                [checked]="isRegionSelected(region.id)"
                (change)="onCheckboxChange($event)"
              />
              <label [for]="region.id">{{ region.name }}</label>
            </li>
          </ul>

          <button class="primary-button" type="submit">არჩევა</button>
        </section>
      </ng-template>

      <!-- Conditional rendering of the template -->
      <ng-container *ngIf="regionFilter" [ngTemplateOutlet]="regionSection"></ng-container>

      <!--   price filter   -->

      <button type="button" class="filter-button"
              [ngClass]="{'filter-act-btn': priceFilter, 'filter-btn': !priceFilter}"
              (click)="priceFilterOn()">
        საფასო კატეგორია
        <img [src]="priceFilter ? '/assets/down-arrow.svg' : '/assets/up-arrow.svg'"
             [alt]="priceFilter ? 'active-filter' : 'inactive-filter'">

      </button>

      <!-- Template definition for the section -->
      <ng-template #priceSection>
        <section class="filter-details price-details mt-2" [formGroup]="myForm">
          <h5 class="text-start">ფასის მიხედვით</h5>

          <div class="price-section">
            <ul class="price-section__min list-unstyled">
              <div class="input-wrapper">
                <input type="number" placeholder="დან" formControlName="minPrice"
                       [class.error]="myForm.get('minPrice')?.value > myForm.get('maxPrice')?.value">
                <span class="lari-sign">₾</span>
                <span *ngIf="myForm.get('minPrice')?.value > myForm.get('maxPrice')?.value" class="price-error">ჩაწერეთ ვალიდური მონაცემები</span>
              </div>

              <b>მინ. ფასი</b>
              <li (click)="setMinPrice(5000)" [class.active]="myForm.get('minPrice')?.value == 5000">5000 ₾</li>
              <li (click)="setMinPrice(10000)" [class.active]="myForm.get('minPrice')?.value == 10000">10000 ₾</li>
              <li (click)="setMinPrice(20000)" [class.active]="myForm.get('minPrice')?.value == 20000">20000 ₾</li>
              <li (click)="setMinPrice(40000)" [class.active]="myForm.get('minPrice')?.value == 40000">40000 ₾</li>
            </ul>

            <ul class="price-section__max list-unstyled">
              <div class="input-wrapper">
                <input type="number" placeholder="მდე" formControlName="maxPrice"
                       [class.error]="myForm.get('minPrice')?.value > myForm.get('maxPrice')?.value">
                <span class="lari-sign">₾</span>
              </div>
              <b>მაქს. ფასი</b>
              <li (click)="setMaxPrice(10000)" [class.active]="myForm.get('maxPrice')?.value == 10000">10000 ₾</li>
              <li (click)="setMaxPrice(20000)" [class.active]="myForm.get('maxPrice')?.value == 20000">20000 ₾</li>
              <li (click)="setMaxPrice(40000)" [class.active]="myForm.get('maxPrice')?.value == 40000">40000 ₾</li>
              <li (click)="setMaxPrice(80000)" [class.active]="myForm.get('maxPrice')?.value == 80000">80000 ₾</li>
            </ul>
          </div>

          <button class="primary-button " type="button" (click)="onPriceSubmit()">არჩევა</button>
        </section>
      </ng-template>

      <!-- Conditional rendering of the template -->
      <ng-container *ngIf="priceFilter" [ngTemplateOutlet]="priceSection"></ng-container>
    </div>


  </form>

  <div class="mt-3">
    <ul class="filtered-category list-unstyled">
      <li class="filtered-section" *ngIf="littleRegions !== undefined"
          (click)="regionFilterOn()">{{ littleRegions }}
        <img src="assets/x.svg" alt="delete-region-filter" (click)="deleteRegions()"/></li>
      <li class="filtered-section" *ngIf="littlePrices !== undefined"
          (click)="priceFilterOn()">{{ littlePrices }}
        <img src="assets/x.svg" alt="delete-prices-filter" (click)="deletePrices()"/></li>

    </ul>
  </div>


</main>
